<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Synesthetic</title>
  <style>
    /* ---------- base ---------- */
    :root {
      color-scheme: dark;
      --piano-h: 120px;
      /* JS updates this on load/resize */
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #0b0b0b;
      color: #eee;
    }

    .wrap {
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 16px;
      height: 100vh;
      height: 100svh;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
      background: #000;
      touch-action: manipulation;
    }

    .panel {
      padding: 12px;
      padding-top: 0px;
      overflow: auto;
      background: #121212;
      border-left: 1px solid #222;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: center;
      margin: 8px 0;
    }

    input[type="range"] {
      width: 160px;
    }

    select,
    input,
    button {
      background: #1a1a1a;
      color: #eee;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      padding: 10px;
    }

    .label {
      opacity: .8;
    }

    header {
      display: flex;
      align-items: center;
      gap: 8px;
      position: sticky;
      top: 0;
      background: #121212;
      padding: 8px 0 12px;
      z-index: 1;
    }

    header h2 {
      margin: 0;
      font-size: 18px;
    }

    .sec-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    /* ---------- mobile split layout ---------- */
    @media (max-width: 768px) {

      html,
      body {
        overflow: hidden;
      }

      /* page itself doesn't scroll */
      .wrap {
        grid-template-columns: 1fr;
        grid-template-rows: 1fr 1fr;
        /* top visuals, bottom controls */
        gap: 8px;
        height: 100svh;
        padding-bottom: calc(var(--piano-h) + env(safe-area-inset-bottom));
        /* leave room for piano */
      }

      .panel {
        height: 100%;
        max-height: 100%;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        border-left: none;
        border-top: 1px solid #222;
        /* Reserve space so last sliders scroll above the piano */
        padding-bottom: calc(var(--piano-h) + 24px + env(safe-area-inset-bottom));
        scroll-padding-bottom: calc(var(--piano-h) + 24px + env(safe-area-inset-bottom));
      }

      .panel::after {
        content: "";
        display: block;
        height: calc(var(--piano-h) + 16px + env(safe-area-inset-bottom));
        pointer-events: none;
      }

      .row {
        grid-template-columns: 1fr;
        gap: 6px;
      }

      input[type="range"] {
        width: 100%;
      }
    }

    /* ---------- desktop help footer ---------- */
    #desktop-help {
      position: fixed;
      left: 16px;
      right: 16px;
      bottom: 16px;
      display: none;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      background: rgba(18, 18, 18, .92);
      border: 1px solid #2a2a2a;
      border-radius: 12px;
      padding: 10px 12px;
      color: #ddd;
      z-index: 12;
      backdrop-filter: blur(6px);
    }

    #desktop-help button {
      background: #1a1a1a;
      color: #eee;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      padding: 8px 10px;
      cursor: pointer;
    }

    #desktop-help .msg {
      font-size: 13px;
      line-height: 1.25;
    }

    #desktop-help .toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      cursor: pointer;
    }

    #desktop-help input[type="checkbox"] {
      accent-color: #888;
    }

    #desktop-help .actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #desktop-help .dontshow {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      cursor: pointer;
    }

    #desktop-help .actions button {
      background: #1a1a1a;
      color: #eee;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      padding: 8px 10px;
      cursor: pointer;
    }

    @media (min-width: 769px) {
      #desktop-help {
        display: flex;
      }
    }

    html.show-desktop-piano #desktop-help,
    html.help-dismissed #desktop-help {
      display: none;
    }

    /* ---------- piano ---------- */
    #piano {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: calc(var(--piano-h) + env(safe-area-inset-bottom));
      background: #0e0e0e;
      border-top: 1px solid #222;
      z-index: 10;
      display: none;
      /* hidden by default on desktop */
      padding: 8px 8px calc(8px + env(safe-area-inset-bottom)) 8px;

      /* NEW: single-column grid (top bar + keys) */
      display: none;
      /* becomes grid in media query */
      grid-template-columns: 1fr;
      grid-template-rows: auto 1fr;
      gap: 6px 8px;

      /* anti-jitter: isolate layout & give its own layer */
      contain: layout paint;
      transform: translateZ(0);
    }

    @media (max-width: 768px) {
      #piano {
        display: grid;
      }
    }

    @media (min-width: 769px) {
      html.show-desktop-piano #piano {
        display: grid;
      }

      html.show-desktop-piano .wrap {
        padding-bottom: calc(var(--piano-h) + env(safe-area-inset-bottom));
      }

      html.show-desktop-piano .panel {
        padding-bottom: calc(var(--piano-h) + 16px + env(safe-area-inset-bottom));
        scroll-padding-bottom: calc(var(--piano-h) + 16px + env(safe-area-inset-bottom));
      }
    }

    /* --- top bar: down | indicator | up --- */
    .piano-top {
      grid-row: 1;
      grid-column: 1;
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 8px;
    }

    #octave-indicator {
      justify-self: center;
      padding: 4px 8px;
      border-radius: 8px;
      background: #141414;
      border: 1px solid #2a2a2a;
      color: #ddd;
      font-size: 12px;
      min-width: 64px;
      /* keeps center stable */
      text-align: center;
    }

    .octave-button {
      border-radius: 6px;
      border: 1px solid #b0b0b0;
      border-bottom-color: #8b8b8b;
      background: linear-gradient(#dcdcdc, #c8c8c8);
      color: #222;
      box-shadow: inset 0 -2px 0 rgba(0, 0, 0, .12);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      height: 28px;
      padding: 0 10px;
      user-select: none;
      touch-action: none;
      pointer-events: auto;
    }

    .octave-button:active {
      background: linear-gradient(#d2d2d2, #bfbfbf);
      box-shadow: inset 0 -1px 0 rgba(0, 0, 0, .18);
      transform: translateY(1px);
    }

    /* --- keys stage (full width) --- */
    .piano-stage {
      grid-column: 1;
      grid-row: 2;
      position: relative;
      height: 100%;
      will-change: transform;
      /* keeps it on the same layer */
    }

    /* layers inside the stage */
    .piano-stage .white-keys,
    .piano-stage .black-keys {
      position: absolute;
      left: 0;
      right: 0;
      pointer-events: none;
      /* let keys handle events */
    }

    .piano-stage .white-keys {
      top: 0;
      bottom: 0;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      padding: 6px 0;
    }

    .piano-stage .black-keys {
      top: 0;
      height: 70%;
    }

    /* white keys */
    .piano-stage .white {
      all: unset;
      pointer-events: auto;
      background: linear-gradient(#fff, #e9e9e9);
      border: 1px solid #bfbfbf;
      border-bottom-color: #8f8f8f;
      border-radius: 6px;
      box-shadow: inset 0 -2px 0 rgba(0, 0, 0, .15);
      color: #222;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      font-size: 12px;
      user-select: none;
      touch-action: none;
    }

    .piano-stage .white.active {
      background: linear-gradient(#f2f2f2, #dcdcdc);
      box-shadow: inset 0 -1px 0 rgba(0, 0, 0, .2);
      transform: translateY(1px);
    }

    /* black keys */
    .piano-stage .black {
      all: unset;
      pointer-events: auto;
      position: absolute;
      top: 6px;
      width: calc((100% / 7) * 0.6);
      left: calc((var(--pos) + 1) * (100% / 7) - ((100% / 7) * 0.3));
      height: calc(70% - 8px);
      background: linear-gradient(#222, #111);
      border: 1px solid #000;
      border-radius: 6px;
      box-shadow: 0 3px 0 rgba(0, 0, 0, .6), inset 0 -2px 0 rgba(255, 255, 255, .06);
      color: #ddd;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      font-size: 11px;
      user-select: none;
      touch-action: none;
    }

    .piano-stage .black.active {
      background: linear-gradient(#1b1b1b, #0e0e0e);
      box-shadow: 0 2px 0 rgba(0, 0, 0, .6), inset 0 -1px 0 rgba(255, 255, 255, .05);
      transform: translateY(1px);
    }

    /* audio unlock button (mobile only) */
    @media (max-width: 768px) {
      #audio-unlock {
        display: block;
      }

      .audio-on #audio-unlock {
        display: none;
      }
    }

    /* interaction hygiene */
    #view,
    #piano button,
    #piano .key {
      touch-action: none;
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
    }
  </style>

</head>

<body>
  <button id="audio-unlock" aria-label="Start audio" style="
  position:fixed; inset:auto 16px 16px 16px; height:48px;
  border-radius:12px; border:1px solid #2a2a2a; background:#161616; color:#fff;
  display:none; z-index:20;
">Tap to Start Audio</button>
  <div class="wrap">
    <canvas id="view" width="1280" height="720"></canvas>
    <div class="panel">
      <header style="display:flex; flex-direction:column; gap:8px;">
        <nav style="display:flex; gap:8px;">
          <a href="/about.html"
            style="background:#141414; border:1px solid #2a2a2a; padding:6px 10px; border-radius:8px; color:#eee; text-decoration:none;">
            About & Favorites
          </a>
        </nav>
        <h2>Be careful if using headphones!</h2>
      </header>
      <form id="controls" class="panel"></form>
    </div>
  </div>
  <script type="module" src="/src/client.ts"></script>


  <div id="piano" aria-label="Piano keys (mobile)">
    <!-- top bar: down | indicator | up -->
    <div class="piano-top" role="group" aria-label="Octave controls">
      <button id="octave-left" class="octave-button" type="button" aria-label="Octave Down">−</button>
      <div id="octave-indicator" aria-live="polite">Oct 0</div>
      <button id="octave-right" class="octave-button" type="button" aria-label="Octave Up">+</button>
    </div>

    <!-- keys stage -->
    <div class="piano-stage">
      <div class="white-keys">
        <button class="white" data-code="KeyA" aria-label="C"></button>
        <button class="white" data-code="KeyS" aria-label="D"></button>
        <button class="white" data-code="KeyD" aria-label="E"></button>
        <button class="white" data-code="KeyF" aria-label="F"></button>
        <button class="white" data-code="KeyG" aria-label="G"></button>
        <button class="white" data-code="KeyH" aria-label="A"></button>
        <button class="white" data-code="KeyJ" aria-label="B"></button>
      </div>

      <div class="black-keys">
        <button class="black" style="--pos:0" data-code="KeyW" aria-label="C sharp"></button>
        <button class="black" style="--pos:1" data-code="KeyE" aria-label="D sharp"></button>
        <!-- (no black key between E and F) -->
        <button class="black" style="--pos:3" data-code="KeyT" aria-label="F sharp"></button>
        <button class="black" style="--pos:4" data-code="KeyY" aria-label="G sharp"></button>
        <button class="black" style="--pos:5" data-code="KeyU" aria-label="A sharp"></button>
      </div>
    </div>
  </div>


  <!-- Desktop keyboard help -->
  <div id="desktop-help" role="region" aria-label="Keyboard help (desktop)">
    <div class="msg">
      Tip: play notes with your computer keyboard — A S D F G H J for white keys and
      W E T Y U for black keys. Use 1 and 2 to change octaves.
    </div>
    <div class="actions">
      <label class="dontshow">
        <input type="checkbox" id="help-dont-show">
        <span>Don’t show again</span>
      </label>
      <button id="dismiss-help" type="button" aria-label="Dismiss help">Dismiss</button>
    </div>
  </div>

</body>

</html>